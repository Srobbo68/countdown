<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Nexus Countdown</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Montserrat', sans-serif;
      background-color: #f4f4f4;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .top-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    .time-box, .countdown-box {
      width: 100%;
      max-width: 800px;
      text-align: center;
      margin-bottom: 20px;
    }

    .title {
      font-size: 36px;
      font-weight: 700;
      color: #005AAA;
      margin-bottom: 10px;
    }

    .time, .countdown {
      font-size: 72px;
      font-weight: 400;
      letter-spacing: 1px;
      min-height: 90px;
    }

    .countdown-label {
      font-size: 36px;
      color: #005AAA;
      margin-top: 10px;
    }

    .main-content {
      display: flex;
      flex: 1;
      width: 100%;
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .event-sidebar {
      width: 300px;
      border-left: 2px solid #ccc;
      padding: 20px;
      background: white;
    }

    .event-sidebar h2 {
      font-size: 36px;
      color: #005AAA;
      margin-bottom: 20px;
    }

    .event {
      margin-bottom: 15px;
    }

    .event-title {
      font-size: 26px;
      color: #005AAA;
      font-weight: bold;
    }

    .event-time {
      font-size: 26px;
      color: #333;
    }

    .ticker {
      width: 100%;
      height: 60px;
      background-color: #ddd;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      font-size: 26px;
      font-weight: 500;
    }

    .ticker-content {
      position: absolute;
      opacity: 0;
      transition: opacity 1s;
    }

    .ticker-content.active {
      opacity: 1;
    }

    .logo {
      max-height: 150px;
      display: block;
      margin: 0 auto 10px;
    }

    .buttons {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }

    .buttons button {
      font-family: 'Montserrat', sans-serif;
      font-size: 16px;
      margin: 0 5px;
      padding: 10px 20px;
      border: none;
      background-color: #ccc;
      cursor: pointer;
    }

    .buttons button.active {
      background-color: #005AAA;
      color: white;
    }
  </style>
</head>
<body>
  <div class="top-section">
    <div class="time-box">
      <div class="title">Current Time</div>
      <div class="time" id="current-time">--:--</div>
    </div>
    <div class="countdown-box">
      <div class="title">Next Session: <span id="next-title"></span></div>
      <div class="countdown" id="countdown">--:--</div>
      <div class="countdown-label" id="countdown-label"></div>
    </div>
  </div>

  <div class="buttons">
    <button class="active" data-filter="all">All</button>
    <button data-filter="G">Garage</button>
    <button data-filter="D">Driver</button>
    <button data-filter="M">Media</button>
  </div>

  <div class="main-content">
    <div class="event-sidebar">
      <h2>Events</h2>
      <div id="event-list">Loading eventsâ€¦</div>
    </div>
  </div>

  <div class="ticker">
    <div class="ticker-content" id="ticker-1"><img src="NPS.png" class="logo"></div>
    <div class="ticker-content" id="ticker-2">Nexus Performance Solutions</div>
    <div class="ticker-content" id="ticker-3">Connecting Strategy to Peak Motorsport Performance</div>
  </div>

  <script>
    const API_KEY = 'YOUR_API_KEY';
    const CALENDAR_ID = 'YOUR_CALENDAR_ID';
    const MAX_EVENTS = 8;
    let filter = 'all';

    function updateTime() {
      const now = new Date();
      document.getElementById("current-time").innerText = now.toLocaleString('en-AU', {
        timeZone: 'Australia/Brisbane', weekday: 'short', hour: '2-digit', minute: '2-digit', hour12: false
      });
    }
    setInterval(updateTime, 1000);
    updateTime();

    function filterTitle(title) {
      return title.replace(/^\s*[GDM]:\s*/, '');
    }

    function loadEvents() {
      gapi.client.init({ apiKey: API_KEY }).then(() => {
        return gapi.client.request({
          path: `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(CALENDAR_ID)}/events`,
          params: {
            singleEvents: true,
            orderBy: 'startTime',
            timeMin: new Date().toISOString(),
            maxResults: 20
          }
        });
      }).then(response => {
        const events = response.result.items.filter(e => {
          if (!e.start.dateTime) return false;
          if (filter === 'all') return true;
          return e.summary && e.summary.trim().startsWith(filter + ':');
        });

        const list = document.getElementById('event-list');
        list.innerHTML = '';

        events.slice(0, MAX_EVENTS).forEach((event, i) => {
          const title = filterTitle(event.summary || '(No title)');
          const start = new Date(event.start.dateTime);
          const local = start.toLocaleString('en-AU', {
            timeZone: 'Australia/Brisbane', weekday: 'short', hour: '2-digit', minute: '2-digit', hour12: false
          });

          const div = document.createElement('div');
          div.className = 'event';
          div.innerHTML = `<div class="event-title">${title}</div><div class="event-time">${local}</div>`;
          list.appendChild(div);

          if (i === 0) startCountdown(event);
        });
      });
    }

    function startCountdown(event) {
      const title = filterTitle(event.summary);
      const start = new Date(event.start.dateTime);
      const end = new Date(event.end.dateTime);
      const now = new Date();

      document.getElementById('next-title').innerText = title;

      let currentTarget = start > now ? start : end;
      let label = start > now ? 'Start:' : 'End:';

      function update() {
        const now = new Date();
        const diff = currentTarget.getTime() - now.getTime();

        if (diff <= 0 && currentTarget === start) {
          currentTarget = end;
          label = 'End:';
        } else if (diff <= 0 && currentTarget === end) {
          loadEvents();
          return;
        }

        const hours = Math.floor((diff % 86400000) / 3600000);
        const mins = Math.floor((diff % 3600000) / 60000);
        const secs = Math.floor((diff % 60000) / 1000);

        const parts = [];
        if (hours > 0) parts.push(`${hours}h`);
        if (hours > 0 || mins > 0) parts.push(`${mins}m`);
        parts.push(`${secs}s`);

        document.getElementById('countdown').innerText = parts.join(' ');
        document.getElementById('countdown-label').innerText = label;
      }

      update();
      setInterval(update, 1000);
    }

    gapi.load('client', loadEvents);

    document.querySelectorAll('.buttons button').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.buttons button').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        filter = btn.dataset.filter;
        loadEvents();
      });
    });

    const tickerItems = ['ticker-1', 'ticker-2', 'ticker-3'];
    let tickerIndex = 0;
    setInterval(() => {
      tickerItems.forEach(id => document.getElementById(id).classList.remove('active'));
      document.getElementById(tickerItems[tickerIndex]).classList.add('active');
      tickerIndex = (tickerIndex + 1) % tickerItems.length;
    }, 4000);
  </script>
  <script src="https://apis.google.com/js/api.js"></script>
</body>
</html>
